function bubbleChart(){function e(v){var w=d3.max(d3.values(v.data),function(C){return C.quotes.USD.price}),x=d3.max(d3.values(v.data),function(C){return C.quotes.USD.percent_change_24h}),y=d3.min(d3.values(v.data),function(C){return C.quotes.USD.percent_change_24h}),z=d3.scalePow().exponent(0.15).range([2,85]).domain([0,w]),A=[];for(var B in v.data)A.push({radius:z(+v.data[B].quotes.USD.price),id:v.data[B].id,name:v.data[B].name,symbol:v.data[B].symbol,price:v.data[B].quotes.USD.price,group:0>v.data[B].quotes.USD.percent_change_24h?'low':0<v.data[B].quotes.USD.percent_change_24h?'high':'medium',percentChange:v.data[B].quotes.USD.percent_change_24h,marketCap:v.data[B].quotes.USD.market_cap});return A.sort(function(C,D){return D.price-C.price}),A}function g(){s.force('x',d3.forceX().strength(o).x(n.x)),s.alpha(1).restart()}function h(v){d3.select(this).attr('stroke','black');var w='<span class="name">Coin name: </span><span class="value">'+v.name+'</span><br/><span class="name">Current price(USD): </span><span class="value">$'+v.price+'</span><br/><span class="name">Percent change in last 24h: </span><span class="value">'+v.percentChange+'%';'</span>',m.showTooltip(w,d3.event)}function i(v){window.location.href='./tablePage.html?name='+v.name+'&marketCap='+v.marketCap+'&price='+v.price+'&percentChange='+v.percentChange}function j(v){d3.select(this).attr('stroke',d3.rgb(t(v.group)).darker()),m.hideTooltip()}var k=940,l=600,m=floatingTooltip('gates_tooltip',240),n={x:k/2,y:l/2},o=0.03,p=null,q=null,r=[],s=d3.forceSimulation().velocityDecay(0.2).force('x',d3.forceX().strength(o).x(n.x)).force('y',d3.forceY().strength(o).y(n.y)).force('charge',d3.forceManyBody().strength(function(v){return-Math.pow(v.radius,2)*o})).on('tick',function(){q.attr('cx',function(v){return v.x}).attr('cy',function(v){return v.y})});s.stop();var t=d3.scaleOrdinal().domain(['low','medium','high']).range(['#d84b2a','#beccae','#7aa25c']);return function(w,x){document.getElementById('toggleButton');r=e(x),p=d3.select(w).append('svg').attr('width',k).attr('height',l),q=p.selectAll('.bubble').data(r,function(A){return A.id});var z=q.enter().append('circle').classed('bubble',!0).attr('r',0).attr('fill',function(A){return t(A.group)}).attr('stroke',function(A){return d3.rgb(t(A.group)).darker()}).attr('stroke-width',2).on('mouseover',h).on('mouseout',j).on('click',i);q=q.merge(z),q.transition().duration(2e3).attr('r',function(A){return A.radius}),s.nodes(r),g()}}var myBubbleChart=bubbleChart();function display(c,e){c&&console.log(c),myBubbleChart('#vis',e)}function setupButtons(){d3.select('.button').on('click',function(){var c=document.getElementById('toggleButton');c.classList.toggle('clicked'),d3.json('https://api.coinmarketcap.com/v2/ticker/?limit=50&sort=rank',display)})}d3.json('https://api.coinmarketcap.com/v2/ticker/?limit=50&sort=rank',display),setupButtons();